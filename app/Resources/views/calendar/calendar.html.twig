{% extends "base.html.twig" %}

{% block body %}
<!DOCTYPE html>
<html>
<head>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
    <meta charset='utf-8' />
    <link href='../fullcalendar.min.css' rel='stylesheet' />
    <link href='../fullcalendar.print.min.css' rel='stylesheet' media='print' />
    <script src='../lib/moment.min.js'></script>
    <script src='../lib/jquery.min.js'></script>
    <script src='../lib/jquery-ui.min.js'></script>
    <script src='../fullcalendar.min.js'></script>
    <script>

        $(document).ready(function() {

            /* initialize the external events
             -----------------------------------------------------------------*/

            $('#external-events .fc-event').each(function() {

                // store data so the calendar knows to render an event upon drop
                $(this).data('event', {
                    title: $.trim($(this).text()), // use the element's text as the event title
                    stick: true // maintain when user navigates (see docs on the renderEvent method)
                });

                // make the event draggable using jQuery UI
                $(this).draggable({
                    zIndex: 999,
                    revert: true,      // will cause the event to go back to its
                    revertDuration: 0  //  original position after the drag
                });

            });


            /* initialize the calendar
             -----------------------------------------------------------------*/
            $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay,listWeek'
                },
                editable: true, //
                navLinks: true, // can click day/week names to navigate views
                eventLimit: true, // allow "more" link when too many events
                droppable: true, // this allows things to be dropped onto the calendar
                events: {
                    url: '{{ path('json') }}',
                    error: function() {
                       // $('#script-warning').show();
                    }
                },

                //dropinimo funkcija

                drop: function() {

                   // is the "remove after drop" checkbox checked?
                    if ($('#drop-remove').is(':checked')) {
                        // if so, remove the element from the "Draggable Events" list
                        $(this).remove();
                    }
                },
/*
neveikia!!!1
 */
                eventReceive: function(event) {

                    $.ajax({
                        url: '{{ path('calendar_drop') }}',
                        type: "POST",
                        data:{
                            title : "event title" ,
                            start : "2017-02-12T00:00:00+01:00",
                            end: "2017-02-13T00:00:00+01:00"
                        },
                        contentType: "application/json; charset=utf-8",
                        dataType: 'json'
                    });

                },

                loading: function(bool) {
                    $('#loading').toggle(bool);
                },

                eventDrop: function(event, delta, revertFunc) {

                    $.ajax({
                        url: '{{ path('calendar_update') }}',
                        type: "POST",
                        data: JSON.stringify({
                            id: event.id,
                            start: event.start.format(),
                            end: event.end.format()
                        }),
                        contentType: "application/json; charset=utf-8",
                        dataType: 'json'
                    });

                },

            });
           // $('.fc-event').data('event', { "title":"draggable event title", "end": "09:00"});
        });



    </script>

    {#  Calendar Styling#}
    <style>

        body {
            margin: 0;
            padding: 0;
            font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
            font-size: 14px;
        }

        #script-warning {
            display: none;
            background-color: #f2dede;
            border-color: #eed3d7;
            border-bottom: 1px solid #ddd;
            padding: 0 10px;
            line-height: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            color: red;
        }

        #loading {
            /*
            display: none;
            position: absolute;
            top: 10px;
            right: 10px;
            */
            position: absolute;
            top: 50%;
            left: 50%;
            margin-left: -15px;
            margin-top: -15px;
            color: #000;
            font-size: 30px;
            font-weight:bold;
            z-index: 2;
        }
        /*
        z-index'o deka loading yra ant kalendorio o ne uz kalendorio.
        */

        #calendar {
            float: right;
            max-width: 900px;
            margin: 40px auto;
            padding: 0 10px;
            z-index: 1;
        }
        #wrap {
            width: 1100px;
            margin: 0 auto;
        }

        #external-events {
            float: left;
            width: 150px;
            padding: 0 10px;
            border: 1px solid #ccc;
            background: #eee;
            text-align: left;
        }

        #external-events h4 {
            font-size: 16px;
            margin-top: 0;
            padding-top: 1em;
        }

        #external-events .fc-event {
            margin: 10px 0;
            cursor: pointer;
        }

        #external-events p {
            margin: 1.5em 0;
            font-size: 11px;
            color: #666;
        }

        #external-events p input {
            margin: 0;
            vertical-align: middle;
        }

    </style>


</head>
<body>


<div id='script-warning'>
    Informacijos apdorojimo klaida. <code>JSON</code> duomenys nepasiekiami.
</div>



<a href="{{ path('calendar_add') }}">Prideti eventa</a>



<div id='calendar'>
    <div id='loading'>
        <i class="fa fa-refresh fa-spin"></i>
        Kraunasi
    </div>
</div>


<div id='wrap'>

    <div id='external-events'>
        <h4>Draggable Events</h4>
        <div class='fc-event'>My Event 1</div>
        <div class='fc-event'>My Event 2</div>
        <div class='fc-event'>My Event 3</div>
        <div class='fc-event'>My Event 4</div>
        <div class='fc-event'>My Event 5</div>
        <p>
            <input type='checkbox' id='drop-remove' />
            <label for='drop-remove'>remove after drop</label>
        </p>
    </div>

    <div id='calendar'></div>

    <div style='clear:both'></div>

</div>


</body>
</html>
{% endblock %}
